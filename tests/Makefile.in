.SUFFIXES: .dac .tex .done
.PHONY: all clean bench

CXX = @DACTYL_CXX@
CXXFLAGS = @DACTYL_CXXFLAGS@
CPPFLAGS = @CPPFLAGS@
DEFS = @DEFS@
LIBS = @LIBS@ -lgsl -lfftw -lm
LDFLAGS = @LDFLAGS@
INSTALL = @INSTALL@
prefix = @prefix@
# c.f. AC_ARG_PROGRAM autoconf docs:
transform=@program_transform_name@
@SET_MAKE@
RUNCODE=@RUNCODE@

VERSION = @VERSION@

###########################################################################

OBJFILES = step_algorithm.o symmetry.o \
		two_dimensional.o cylindrical.o one_dimensional.o \
		three_d.o bench.o flux.o
TESTFILES = step_algorithm.dac symmetry.dac \
		two_dimensional.dac cylindrical.dac one_dimensional.dac \
		three_d.dac bench.dac flux.dac
DONEFILES = step_algorithm.done symmetry.done \
	cylindrical.done one_dimensional.done two_dimensional.done \
	three_d.done bench.done flux.done

$(OBJFILES): ../dactyl.h
$(TESTFILES): ../libdactyl.a

.cpp.o:
	$(CXX) -c $(DEFS) $(CPPFLAGS) -I.. $(CXXFLAGS) $< -o $@
.o.dac:
	$(CXX) $(CFLAGS) $(LDFLAGS) $< ../libdactyl.a $(LIBS) -o $@
.dac.done:
	$(RUNCODE) ./$< && touch $@

all: $(TESTFILES)

test: $(DONEFILES)

bench: bench.dac
	$(RUNCODE) ./bench.dac

clean:
	rm -rf *.o *.dac debug_out_* *.done
