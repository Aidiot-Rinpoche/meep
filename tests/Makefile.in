.SUFFIXES: .dac .tex
.PHONY: all clean bench

CXX = @DACTYL_CXX@
CXXFLAGS = @DACTYL_CXXFLAGS@
CPPFLAGS = @CPPFLAGS@
DEFS = @DEFS@
LIBS = @LIBS@ -lgsl -lfftw -lm
LDFLAGS = @LDFLAGS@
INSTALL = @INSTALL@
prefix = @prefix@
# c.f. AC_ARG_PROGRAM autoconf docs:
transform=@program_transform_name@
@SET_MAKE@
RUNCODE=@RUNCODE@

VERSION = @VERSION@

all: dactyl.ps dactyl/dactyl.html preproc

###########################################################################

OBJFILES = cylindrical.o one_dimensional.o bench.o
TESTFILES = cylindrical.dac one_dimensional.dac bench.dac

$(OBJFILES): ../dactyl.h
$(TESTFILES): ../libdactyl.a

.cpp.o:
	$(CXX) -c $(DEFS) $(CPPFLAGS) -I.. $(CXXFLAGS) $< -o $@
.o.dac:
	$(CXX) $(CFLAGS) $(LDFLAGS) $< ../libdactyl.a $(LIBS) -o $@

test: $(TESTFILES) bench
	set -e
	$(RUNCODE) ./one_dimensional.dac
	$(RUNCODE) ./cylindrical.dac

bench: $(TESTFILES)
	set -e
	$(RUNCODE) ./bench.dac

clean:
	rm -rf *.o *.dac *-out/ *-out-*/
